<template>
  <div class="space-y-6">
    <div class="flex items-center justify-between">
      <h2 class="text-2xl font-bold">Yeni Ã–deme Ekle</h2>
      <div class="">
        <button
          class="border border-[#092C4C] bg-[#092C4C] rounded-md p-2 text-[#ffffff] hover:text-[#092C4C] hover:bg-[white] flex items-center gap-3 transition"
          @click="router.back()"
        >
          <ArrowUturnLeftIcon class="w-5 h-5" />
          Geri DÃ¶n
        </button>
      </div>
    </div>

    <!-- MÃ¼ÅŸteri SeÃ§imi -->
    <div>
      <label class="block text-sm font-medium mb-1">MÃ¼ÅŸteri SeÃ§</label>
      <select
        v-model="selectedCustomer"
        class="w-full border rounded px-4 py-2"
      >
        <option disabled value="">MÃ¼ÅŸteri seÃ§iniz</option>
        <option v-for="m in customers" :key="m.id" :value="m">
          {{ m.companyName }}
        </option>
      </select>
    </div>
    <!-- Tarih SeÃ§imi -->
    <div>
      <label class="block text-sm font-medium mb-1">Ã–deme Tarihi</label>
      <input
        type="date"
        v-model="paymentDate"
        class="w-full border rounded px-4 py-2"
      />
    </div>

    <!-- Tutar -->
    <div>
      <label class="block text-sm font-medium mb-1">Tutar (â‚º)</label>
      <input
        type="number"
        v-model="amount"
        class="w-full border rounded px-4 py-2"
        placeholder="Ã–deme tutarÄ±"
      />
    </div>

    <!-- Ã–deme TÃ¼rÃ¼ -->
    <div>
      <label class="block text-sm font-medium mb-1">Ã–deme TÃ¼rÃ¼</label>
      <select v-model="paymentType" class="w-full border rounded px-4 py-2">
        <option value="Nakit">Nakit</option>
        <option value="Havale">Havale</option>
        <option value="Ã‡ek">Ã‡ek</option>
      </select>
    </div>

    <!-- AÃ§Ä±klama -->
    <div>
      <label class="block text-sm font-medium mb-1">AÃ§Ä±klama</label>
      <textarea
        v-model="description"
        rows="3"
        class="w-full border rounded px-4 py-2"
        placeholder="AÃ§Ä±klama girin..."
      ></textarea>
    </div>

    <!-- Kaydet Butonu -->
    <button
      @click="submitPayment"
      class="bg-[#FE9F43] hover:bg-orange-500 text-white px-4 py-2 rounded transition"
    >
      Ã–deme Kaydet
    </button>
  </div>
</template>

<script setup>
import { ref, onMounted } from "vue";
import { useRouter } from "vue-router";
import { useToast } from "vue-toast-notification";
import { ArrowUturnLeftIcon } from "@heroicons/vue/24/outline";
// ðŸ‘‰ TÃ¼m veri iÅŸlemleri JS dosyasÄ±ndan
import { getCustomerList, addCustomerPayment } from "@/stores/customerPayments";

const router = useRouter();
const $toast = useToast();

const customers = ref([]);
const selectedCustomer = ref("");
const amount = ref("");
const paymentType = ref("Nakit");
const description = ref("");
const paymentDate = ref(new Date().toISOString().split("T")[0]);

// MÃ¼ÅŸteri listesini Ã§ek
onMounted(async () => {
  customers.value = (await getCustomerList()).sort((a, b) =>
    a.companyName.localeCompare(b.companyName, "tr", { sensitivity: "base" })
  );
});

// Ã–deme kaydÄ± ekle
const submitPayment = async () => {
  if (!selectedCustomer.value || !amount.value) {
    $toast.error("LÃ¼tfen mÃ¼ÅŸteri ve tutar alanlarÄ±nÄ± doldurun.");
    return;
  }

  try {
    await addCustomerPayment({
      customerId: selectedCustomer.value.id,
      companyName: selectedCustomer.value.companyName,
      amount: Number(amount.value),
      type: paymentType.value,
      description: description.value,
      date: paymentDate.value,
    });

    $toast.success("Ã–deme kaydedildi!");
    router.push("/customer-payments");
  } catch (error) {
    console.error("Ã–deme ekleme hatasÄ±:", error);
    $toast.error("Bir hata oluÅŸtu.");
  }
};
</script>
